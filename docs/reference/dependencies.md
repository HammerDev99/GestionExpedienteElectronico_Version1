# Dependencias del Sistema

## Dependencias de Producci√≥n

### Dependencias Cr√≠ticas

#### xlwings==0.28.5
```bash
pip install xlwings==0.28.5
```

**Prop√≥sito**: Automatizaci√≥n COM de Microsoft Excel  
**Criticidad**: üî¥ **CR√çTICA** - Sin esta dependencia la aplicaci√≥n no funciona  
**Uso**: Generaci√≥n de √≠ndices Excel, aplicaci√≥n de f√≥rmulas, apertura autom√°tica de archivos

**Configuraci√≥n espec√≠fica**:
```python
import xlwings as xw

# Configuraci√≥n t√≠pica
app = xw.App(visible=False)  # Excel oculto durante procesamiento
wb = app.books.open(template_path)
```

**Requisitos adicionales**:
- Microsoft Excel debe estar instalado
- Compatible con Excel 2016, 2019, 365
- Requiere pywin32 para funcionamiento COM

#### pandas==1.5.2
```bash
pip install pandas==1.5.2
```

**Prop√≥sito**: Manipulaci√≥n y an√°lisis de datos estructurados  
**Criticidad**: üü° **IMPORTANTE** - Usado para procesamiento de metadatos  
**Uso**: Creaci√≥n de DataFrames, manipulaci√≥n de datos CSV, exportaci√≥n a Excel

**Casos de uso principales**:
```python
import pandas as pd

# Lectura de datos de referencia
juzgados_df = pd.read_csv('JUZGADOS.csv')

# Creaci√≥n de DataFrame para √≠ndice
index_data = pd.DataFrame({
    'Nombre_Documento': file_names,
    'Numero_Paginas': page_counts,
    'Fecha_Creacion': creation_dates
})
```

#### PyPDF2==2.11.2
```bash
pip install PyPDF2==2.11.2
```

**Prop√≥sito**: Procesamiento de archivos PDF  
**Criticidad**: üü° **IMPORTANTE** - Esencial para extracci√≥n de metadatos PDF  
**Uso**: Conteo de p√°ginas, extracci√≥n de metadatos, manejo de archivos protegidos

**Funcionalidades utilizadas**:
```python
from PyPDF2 import PdfReader

def get_pdf_pages(file_path):
    try:
        reader = PdfReader(file_path)
        return len(reader.pages)
    except Exception as e:
        # Manejo de PDFs protegidos/corruptos
        return 0
```

#### pywin32==306
```bash
pip install pywin32==306
```

**Prop√≥sito**: Integraci√≥n COM con Windows y Excel  
**Criticidad**: üî¥ **CR√çTICA** - Requerida para xlwings y automatizaci√≥n Windows  
**Uso**: Interfaz COM, servicios Windows, acceso a APIs nativas

**Componentes utilizados**:
- `win32com.client`: Cliente COM para Excel
- `pythoncom`: Inicializaci√≥n COM
- `pywintypes`: Tipos de datos Windows

### Dependencias Importantes

#### Pillow>=8.3.2
```bash
pip install Pillow>=8.3.2
```

**Prop√≥sito**: Procesamiento de im√°genes  
**Uso**: Manejo de iconos, im√°genes en tooltips, recursos gr√°ficos de la GUI  
**Casos de uso**: Carga de PNG/ICO para interfaz gr√°fica

#### send2trash>=1.8.0
```bash
pip install send2trash>=1.8.0
```

**Prop√≥sito**: Eliminaci√≥n segura de archivos  
**Uso**: Env√≠o de √≠ndices existentes a la papelera en lugar de eliminaci√≥n permanente  
**Ventaja**: Permite recuperaci√≥n de archivos eliminados por error

```python
from send2trash import send2trash

# Eliminaci√≥n segura de √≠ndice existente
if existing_index.exists():
    send2trash(str(existing_index))
```

### Dependencias del Sistema Base

#### tkinter (incluido en Python)
**Prop√≥sito**: Framework GUI nativo de Python  
**Uso**: Interfaz gr√°fica principal, di√°logos, widgets  
**Ventaja**: No requiere instalaci√≥n adicional en instalaciones est√°ndar de Python

**Componentes utilizados**:
```python
import tkinter as tk
from tkinter import ttk, filedialog, messagebox

# GUI principal
root = tk.Tk()
style = ttk.Style()
progress_bar = ttk.Progressbar(root)
```

## Dependencias de Desarrollo

### Testing y Quality Assurance

#### pytest>=6.0.0
```bash
pip install pytest>=6.0.0
```

**Prop√≥sito**: Framework de testing  
**Uso**: Ejecuci√≥n de tests unitarios e integraci√≥n  
**Configuraci√≥n**: Ver `pytest.ini` para configuraci√≥n espec√≠fica

#### pytest-cov>=2.0.0
```bash
pip install pytest-cov>=2.0.0
```

**Prop√≥sito**: An√°lisis de cobertura de c√≥digo  
**Uso**: Generaci√≥n de reportes HTML de cobertura

#### black>=22.0.0
```bash
pip install black>=22.0.0
```

**Prop√≥sito**: Formateo autom√°tico de c√≥digo  
**Configuraci√≥n**: L√≠nea m√°xima 88 caracteres
```bash
black --line-length=88 src/
```

#### flake8>=4.0.0
```bash
pip install flake8>=4.0.0
```

**Prop√≥sito**: An√°lisis est√°tico de c√≥digo (linting)  
**Configuraci√≥n**: Compatible con formato Black
```bash
flake8 --max-line-length=88 --extend-ignore=E203 src/
```

#### isort>=5.0.0
```bash
pip install isort>=5.0.0
```

**Prop√≥sito**: Organizaci√≥n autom√°tica de imports  
**Configuraci√≥n**: Perfil compatible con Black
```bash
isort --profile=black src/
```

### Build y Distribuci√≥n

#### PyInstaller==5.13.0
```bash
pip install PyInstaller==5.13.0
```

**Prop√≥sito**: Creaci√≥n de ejecutables standalone  
**Uso**: Empaquetado de la aplicaci√≥n para distribuci√≥n  
**Configuraci√≥n**: Ver `config/main.spec`

#### pre-commit>=2.0.0
```bash
pip install pre-commit>=2.0.0
```

**Prop√≥sito**: Hooks de Git para calidad de c√≥digo  
**Configuraci√≥n**: Ver `.pre-commit-config.yaml`

### Documentaci√≥n

#### mkdocs-material>=8.0.0
```bash
pip install mkdocs-material>=8.0.0
```

**Prop√≥sito**: Generaci√≥n de documentaci√≥n est√°tica  
**Uso**: Esta documentaci√≥n que est√°s leyendo

#### mkdocstrings[python]>=0.19.0
```bash
pip install mkdocstrings[python]>=0.19.0
```

**Prop√≥sito**: Generaci√≥n autom√°tica de documentaci√≥n API desde docstrings

## An√°lisis de Dependencias

### Mapa de Dependencias Cr√≠ticas

```mermaid
graph TD
    A[GestionExpedienteElectronico] --> B[xlwings]
    A --> C[pandas]
    A --> D[PyPDF2]
    A --> E[tkinter]
    
    B --> F[pywin32]
    B --> G[Microsoft Excel]
    
    F --> H[Windows COM]
    
    C --> I[numpy]
    C --> J[openpyxl]
    
    D --> K[PDF Processing]
    
    E --> L[GUI Components]
    
    style A fill:#e1f5fe
    style B fill:#ffebee
    style F fill:#ffebee
    style G fill:#ffcdd2
```

### Compatibilidad de Versiones

#### Python
- **M√≠nimo**: 3.9.6
- **Recomendado**: 3.9.x o 3.10.x
- **M√°ximo probado**: 3.11.x

#### Sistema Operativo
- **Principal**: Windows 10/11
- **Compatible**: Windows 7/8.1 (con limitaciones)
- **Experimental**: Linux (sin soporte Excel completo)
- **No soportado**: macOS (limitaciones COM)

#### Microsoft Excel
- **M√≠nimo**: Excel 2016
- **Recomendado**: Excel 2019 o Microsoft 365
- **Arquitectura**: Preferiblemente 64-bit

### Resoluci√≥n de Conflictos

#### Problema: Versiones incompatibles de pywin32
```bash
# Soluci√≥n: Reinstalaci√≥n limpia
pip uninstall pywin32 -y
pip install pywin32==306
python -m pywin32_postinstall -install
```

#### Problema: xlwings no detecta Excel
```bash
# Verificar instalaci√≥n de Excel
python -c "import xlwings as xw; app = xw.App(); print('Excel detectado'); app.quit()"

# Si falla, reinstalar xlwings
pip uninstall xlwings -y
pip install xlwings==0.28.5
```

#### Problema: Dependencias circulares en pandas
```bash
# Actualizar numpy primero
pip install --upgrade numpy
pip install --upgrade pandas==1.5.2
```

## Seguridad de Dependencias

### Vulnerabilidades Conocidas

#### PyPDF2 - Advertencia de Seguridad
- **Versi√≥n actual**: 2.11.2 (√∫ltima con compatibilidad probada)
- **Recomendaci√≥n**: No procesar PDFs de fuentes no confiables
- **Mitigaci√≥n**: Validaci√≥n de archivos antes del procesamiento

#### Pillow - Updates de Seguridad
```bash
# Mantener actualizado para patches de seguridad
pip install --upgrade "Pillow>=8.3.2"
```

### Verificaci√≥n de Integridad

#### Script de Verificaci√≥n
```python
#!/usr/bin/env python3
"""
Verificar integridad y compatibilidad de dependencias.
"""

import subprocess
import sys
from importlib import import_module

def check_critical_imports():
    """Verificar que todas las dependencias cr√≠ticas se puedan importar."""
    critical_modules = [
        'xlwings',
        'pandas', 
        'PyPDF2',
        'tkinter',
        'win32com.client',
        'PIL',
        'send2trash'
    ]
    
    results = {}
    for module_name in critical_modules:
        try:
            import_module(module_name)
            results[module_name] = "‚úÖ OK"
        except ImportError as e:
            results[module_name] = f"‚ùå ERROR: {e}"
    
    return results

def check_excel_connectivity():
    """Verificar conectividad con Excel."""
    try:
        import xlwings as xw
        app = xw.App(visible=False)
        app.quit()
        return "‚úÖ Excel COM disponible"
    except Exception as e:
        return f"‚ùå Excel COM error: {e}"

def main():
    print("üîç Verificando dependencias cr√≠ticas...")
    
    # Verificar imports
    import_results = check_critical_imports()
    for module, status in import_results.items():
        print(f"  {module}: {status}")
    
    # Verificar Excel
    print("\nüîç Verificando conectividad Excel...")
    excel_status = check_excel_connectivity()
    print(f"  Excel COM: {excel_status}")
    
    # Verificar versiones
    print("\nüìã Versiones instaladas:")
    packages = ['xlwings', 'pandas', 'PyPDF2', 'pywin32', 'Pillow']
    for package in packages:
        try:
            result = subprocess.run([sys.executable, '-m', 'pip', 'show', package], 
                                  capture_output=True, text=True)
            if result.returncode == 0:
                for line in result.stdout.split('\n'):
                    if line.startswith('Version:'):
                        print(f"  {package}: {line.split(': ')[1]}")
        except Exception:
            print(f"  {package}: ‚ùå Error al obtener versi√≥n")

if __name__ == "__main__":
    main()
```

## Instalaci√≥n Optimizada

### Archivo requirements.txt Completo

```txt
# Dependencias cr√≠ticas de producci√≥n
xlwings==0.28.5
pandas==1.5.2
PyPDF2==2.11.2
pywin32==306

# Dependencias importantes
Pillow>=8.3.2
send2trash>=1.8.0

# Dependencias opcionales para funcionalidades espec√≠ficas
python-docx>=0.8.11  # Para procesamiento Word mejorado
openpyxl>=3.0.9      # Para manipulaci√≥n Excel adicional

# Solo para desarrollo (comentar en producci√≥n)
# pytest>=6.0.0
# pytest-cov>=2.0.0
# black>=22.0.0
# flake8>=4.0.0
# isort>=5.0.0
# mypy>=0.991
# pre-commit>=2.0.0
```

### Script de Instalaci√≥n Automatizada

```bash
#!/bin/bash
# install_dependencies.sh

echo "üöÄ Instalando dependencias de GestionExpedienteElectronico..."

# Verificar Python
python --version || { echo "‚ùå Python no encontrado"; exit 1; }

# Actualizar pip
echo "üì¶ Actualizando pip..."
python -m pip install --upgrade pip

# Instalar dependencias cr√≠ticas en orden
echo "‚ö° Instalando dependencias cr√≠ticas..."
python -m pip install pywin32==306
python -m pip install xlwings==0.28.5
python -m pip install pandas==1.5.2
python -m pip install PyPDF2==2.11.2

# Post-instalaci√≥n pywin32
echo "‚öôÔ∏è Configurando pywin32..."
python -m pywin32_postinstall -install

# Instalar resto de dependencias
echo "üìã Instalando dependencias adicionales..."
python -m pip install -r requirements.txt

# Verificar instalaci√≥n
echo "üß™ Verificando instalaci√≥n..."
python -c "
import xlwings as xw
import pandas as pd
import PyPDF2
print('‚úÖ Todas las dependencias instaladas correctamente')
"

echo "üéâ Instalaci√≥n completada!"
```

---

!!! info "Mantenimiento de Dependencias"
    Revisa regularmente las actualizaciones de dependencias, especialmente las relacionadas con seguridad. Usa `pip-audit` para verificar vulnerabilidades conocidas.